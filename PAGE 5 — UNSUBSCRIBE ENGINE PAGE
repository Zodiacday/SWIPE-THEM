5. UNSUBSCRIBE ENGINE
The Unsubscribe Engine is responsible for executing safe, reliable, metadata‑only unsubscribe actions across all email providers.
It must handle:

HTTP unsubscribe links

Mailto unsubscribe links

Provider‑specific unsubscribe mechanisms

Fallback logic

Error handling

Safety constraints

Logging

Undo

This page defines the full unsubscribe system, including detection, execution, safety, and edge‑case handling.

5.1 Unsubscribe Philosophy
The engine must be:

1. Safe
Never unsubscribe from transactional or personal senders.

2. Deterministic
Always follow a predictable, transparent flow.

3. Metadata‑only
Never read email content.

4. Provider‑agnostic
Work across Gmail, Outlook, Yahoo, iCloud, Fastmail, IMAP.

5. Reversible
Every unsubscribe action must support undo.

6. User‑controlled
AI may suggest, but never auto‑unsubscribe.

5.2 Unsubscribe Detection Pipeline
The engine identifies unsubscribe options using:

1. List‑Unsubscribe Header (Primary Signal)
Example:

Code
List-Unsubscribe: <http://unsubscribe.example.com>, <mailto:unsubscribe@example.com>
We parse:

HTTP link

Mailto link

Multiple links

Angle‑bracket formatting

Comma‑separated lists

2. Gmail “List-Unsubscribe-Post” Header
Indicates POST‑based unsubscribe.

3. Outlook “Unsubscribe” Actions
Outlook sometimes embeds unsubscribe actions in message extensions.

4. HTML Metadata (Secondary Signal)
We detect:

<link rel="unsubscribe" href="...">

<meta name="unsubscribe" content="...">

5. Sender Reputation
If sender is known newsletter provider → assume unsubscribe exists.

5.3 Unsubscribe Execution Flow
The engine follows this strict order:

Step 1 — Check Safety Rules
Before doing anything:

Is this a transactional email?

Is this a personal sender?

Is this a mixed‑purpose sender (Amazon, Apple, banks)?

Is the unsubscribe link suspicious?

Is the domain high‑risk?

If unsafe → block unsubscribe and require manual confirmation.

Step 2 — HTTP Unsubscribe (Preferred Method)
If HTTP link exists:

Execution:
Perform GET request

If GET fails → try POST

Follow redirects

Respect HTTPS only

Timeout: 3 seconds

User agent: generic browser UA

Success Criteria:
200 OK

204 No Content

302 redirect to confirmation page

Failure Handling:
Retry once

If still failing → fallback to mailto

Step 3 — Mailto Unsubscribe (Secondary Method)
If mailto link exists:

Execution:
Send email:

Code
To: unsubscribe@example.com
Subject: unsubscribe
Body: unsubscribe
Success Criteria:
Email accepted by provider

No bounce within 5 seconds

Failure Handling:
Retry once

If still failing → fallback to block sender

Step 4 — Provider‑Specific Unsubscribe
Gmail
Use Gmail’s native unsubscribe UI when available

Trigger via Gmail API if supported

Outlook
Use message extension unsubscribe actions

Yahoo
Use List‑Unsubscribe only

IMAP
No provider‑level unsubscribe

Use HTTP/mailto only

Step 5 — Fallback Logic
If all unsubscribe attempts fail:

Fallback 1 — Block Sender
Create rule to auto‑delete future emails

Delete existing emails from sender

Fallback 2 — Domain Nuke (Optional)
If sender domain is known spammy:

Block entire domain

Delete all emails from domain

Fallback 3 — Mark as Spam
Provider‑specific spam marking.

5.4 Error Handling
HTTP Errors
404 → fallback

500 → retry

Timeout → retry once

SSL error → fallback

Mailto Errors
SMTP rejection → fallback

Bounce → fallback

Provider Errors
Rate limit → exponential backoff

Auth error → re‑auth flow

Suspicious Links
If unsubscribe URL contains:

IP addresses

Tracking parameters only

Suspicious domains

→ require manual confirmation.

5.5 Safety Rules
Rule 1 — Never unsubscribe from transactional senders
Examples:

Amazon receipts

Bank alerts

Password resets

Security notifications

Rule 2 — Never unsubscribe from personal senders
If sender is a real human → block unsubscribe.

Rule 3 — Never unsubscribe from mixed‑purpose senders
Examples:

Apple

Google

Airlines

Banks

Rule 4 — Always allow undo
Undo must restore:

Subscription status

Sender rules

Domain rules

Rule 5 — Never auto‑unsubscribe
AI may suggest, but user must confirm.

5.6 Logging
Every unsubscribe attempt logs:

Code
UnsubscribeLog {
  id
  user_id
  email_id
  method: "http" | "mailto" | "provider" | "fallback"
  status: "success" | "failed"
  timestamp
  metadata
}
Logs power:

Undo

AI learning

Stats

Automation rules

5.7 Performance Requirements
Unsubscribe execution < 500ms

HTTP timeout < 3 seconds

Mailto send < 200ms

Fallback < 100ms

Undo < 100ms

5.8 Output Object
Code
UnsubscribeResult {
  success: boolean,
  method: string,
  fallback_used: boolean,
  undo_token: string,
  metadata: object
}
